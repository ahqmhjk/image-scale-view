# !/bin/bash

set -e

# default parameters
GTK=2
DEBUG="no"
PREFIX=""
BINDIR=""
LIBDIR=""
INCLUDEDIR=""
MANDIR=""
DOCDIR=""
OUTDIR="obj"
CC="gcc"
CPP="g++"
EXEC="gtkwin"

GTK3_PATH=/usr/include/gtk-3.0/
if test -d $GTK3_PATH
then
	GTK=3
fi

function coloroutput() {
	echo -e "\e[$1m\e[1m$2\e[0m"
}

function usage() {

coloroutput 33  "Usage: configure [options]"
coloroutput 33  "Options: [defaults in brackets after descriptions]"
echo ""
coloroutput 33  "Standard options:"
coloroutput 33  "  --help or -h             print this message"
coloroutput 33 "  --prefix=PREFIX          install in PREFIX [$prefix]"
coloroutput 33 "  --bindir=DIR             user executables in DIR [EPREFIX/bin]"
coloroutput 33 "  --libdir=DIR             object code libraries in DIR [EPREFIX/lib]"
coloroutput 33 "  --includedir=DIR         C header files in DIR [PREFIX/include]"
coloroutput 33 "  --mandir=DIR             man documentation in DIR [PREFIX/man]"
coloroutput 33 "  --docdir=DIR             doc documentation in DIR [PREFIX/doc]"
coloroutput 33 "  --outdir=DIR             output file in DIR [PREFIX/doc]"
coloroutput 33 "  --exec=EXEC              output exec file name"
echo ""
coloroutput 33 "Advanced options (experts only):"
coloroutput 33 "  --cc=CC                  use C compiler CC [$CC]"
coloroutput 33 "  --cpp=CPP                use CPP compiler CPP [$CPP]"
coloroutput 33 "  --debug                  whether support Debug[Default:No]"
echo ""
	
exit 0
}

for opt do
  case "$opt" in
  --prefix=*) PREFIX=`echo $opt | cut -d '=' -f 2`
  ;;
  --bindir=*) BINDIR=`echo $opt | cut -d '=' -f 2`
  ;;
  --libdir=*) LIBDIR=`echo $opt | cut -d '=' -f 2`
  ;;
  --includedir=*) INCLUDEDIR=`echo $opt | cut -d '=' -f 2`
  ;;
  --mandir=*) MANDIR=`echo $opt | cut -d '=' -f 2`
  ;;
  --docdir=*) DOCDIR=`echo $opt | cut -d '=' -f 2`
  ;;
  --cc=*) CC=`echo $opt | cut -d '=' -f 2`
  ;;
  --cpp=*) CPP=`echo $opt | cut -d '=' -f 2`
  ;;
  --exec=*) EXEC=`echo $opt | cut -d '=' -f 2`
  ;;
  --outdir=*) OUTDIR=`echo $opt | cut -d '=' -f 2`
  ;;
  --debug) DEBUG="yes"
  ;;
  --help | -h) usage
  ;;
	esac
done

if test -z "$PREFIX" ; then
	PREFIX="/usr/local"
fi
if test x"$BINDIR" = x""; then
  BINDIR="${PREFIX}/bin"
fi
if test x"$LIBDIR" = x""; then
  LIBDIR="${PREFIX}/lib"
fi
if test x"$INCLUDEDIR" = x""; then
  INCLUDEDIR="${PREFIX}/include"
fi
if test x"$DOCDIR" = x""; then
  DOCDIR="${PREFIX}/share/doc"
fi
if test x"$MANDIR" = x""; then
  MANDIR="${PREFIX}/share/man"
fi

if [ ! -d $OUTDIR ]
then
	mkdir -p $OUTDIR
fi


coloroutput 32 "Prefix  directory   $PREFIX"
coloroutput 32 "Binary  directory   $BINDIR"
coloroutput 32 "Library directory   $LIBDIR"
coloroutput 32 "Include directory   $INCLUDEDIR"
coloroutput 32 "Manual directory    $MANDIR"
coloroutput 32 "Doc directory       $DOCDIR"
coloroutput 32 "Output directory    $OUTDIR"
coloroutput 32 "The Executable Name $EXEC"
coloroutput 32 "C compiler    	    $CC"
coloroutput 32 "C++ compiler  	    $CPP"
coloroutput 32 "Use Debug     	    $DEBUG"
coloroutput 35 "Creating Makefile"


echo "##################################################" > Makefile
echo "# copyright-2010-Hu Jiakuan.                     #" >> Makefile
echo "#                                                #" >> Makefile
echo "#                                                #" >> Makefile
echo "##################################################" >> Makefile

echo "GTK=$GTK" >> Makefile
echo "PREFIX=$PREFIX" >> Makefile
echo "BINDIR=$BINDIR" >> Makefile
echo "LIBDIR=$LIBDIR" >> Makefile
echo "INCLUDEDIR=$INCLUDEDIR" >> Makefile
echo "MANDIR=$MANDIR" >> Makefile
echo "DOCDIR=$DOCDIR" >> Makefile
echo "DEBUG=$DEBUG" >> Makefile
echo "CC=$CC" >> Makefile
echo "CPP=$CPP" >> Makefile
echo "EXEC=$EXEC" >> Makefile
echo "OUTDIR=$OUTDIR" >> Makefile
cat Makefile.mk >> Makefile



exit 0
