# !/bin/bash

set -e

# default parameters
GTK=2
DEBUG="no"
PREFIX=""
BINDIR=""
LIBDIR=""
INCLUDEDIR=""
MANDIR=""
DOCDIR=""
OUTDIR="obj"
CC="gcc"
CPP="g++"
EXEC="gtkwin"

GTK3_PATH=/usr/include/gtk-3.0/
if test -d $GTK3_PATH
then
	GTK=3
fi

function usage() {

echo "Usage: configure [options]"
echo "Options: [defaults in brackets after descriptions]"
echo ""
echo "Standard options:"
echo "  --help or -h             print this message"
echo "  --prefix=PREFIX          install in PREFIX [$prefix]"
echo "  --bindir=DIR             user executables in DIR [EPREFIX/bin]"
echo "  --libdir=DIR             object code libraries in DIR [EPREFIX/lib]"
echo "  --includedir=DIR         C header files in DIR [PREFIX/include]"
echo "  --mandir=DIR             man documentation in DIR [PREFIX/man]"
echo "  --docdir=DIR             doc documentation in DIR [PREFIX/doc]"
echo "  --outdir=DIR             output file in DIR [PREFIX/doc]"
echo "  --exec=EXEC              output exec file name"
echo ""
echo "Advanced options (experts only):"
echo "  --cc=CC                  use C compiler CC [$CC]"
echo "  --cpp=CPP                use CPP compiler CPP [$CPP]"
echo "  --debug                  whether support Debug[Default:No]"
echo ""
	
exit 0
}

for opt do
  case "$opt" in
  --prefix=*) PREFIX=`echo $opt | cut -d '=' -f 2`
  ;;
  --bindir=*) BINDIR=`echo $opt | cut -d '=' -f 2`
  ;;
  --libdir=*) LIBDIR=`echo $opt | cut -d '=' -f 2`
  ;;
  --includedir=*) INCLUDEDIR=`echo $opt | cut -d '=' -f 2`
  ;;
  --mandir=*) MANDIR=`echo $opt | cut -d '=' -f 2`
  ;;
  --docdir=*) DOCDIR=`echo $opt | cut -d '=' -f 2`
  ;;
  --cc=*) CC=`echo $opt | cut -d '=' -f 2`
  ;;
  --cpp=*) CPP=`echo $opt | cut -d '=' -f 2`
  ;;
  --exec=*) EXEC=`echo $opt | cut -d '=' -f 2`
  ;;
  --outdir=*) OUTDIR=`echo $opt | cut -d '=' -f 2`
  ;;
  --debug) DEBUG="yes"
  ;;
  --help | -h) usage
  ;;
	esac
done

if test -z "$PREFIX" ; then
	PREFIX="/usr/local"
fi
if test x"$BINDIR" = x""; then
  BINDIR="${PREFIX}/bin"
fi
if test x"$LIBDIR" = x""; then
  LIBDIR="${PREFIX}/lib"
fi
if test x"$INCLUDEDIR" = x""; then
  INCLUDEDIR="${PREFIX}/include"
fi
if test x"$DOCDIR" = x""; then
  DOCDIR="${PREFIX}/share/doc"
fi
if test x"$MANDIR" = x""; then
  MANDIR="${PREFIX}/share/man"
fi

if [ ! -d $OUTDIR ]
then
	mkdir -p $OUTDIR
fi

echo "creating Makefile"
echo "##################################################" > Makefile
echo "# copyright-2010-Hu Jiakuan.                     #" >> Makefile
echo "#                                                #" >> Makefile
echo "#                                                #" >> Makefile
echo "##################################################" >> Makefile

echo "GTK=$GTK" >> Makefile
echo "PREFIX=$PREFIX" >> Makefile
echo "BINDIR=$BINDIR" >> Makefile
echo "LIBDIR=$LIBDIR" >> Makefile
echo "INCLUDEDIR=$INCLUDEDIR" >> Makefile
echo "MANDIR=$MANDIR" >> Makefile
echo "DOCDIR=$DOCDIR" >> Makefile
echo "DEBUG=$DEBUG" >> Makefile
echo "CC=$CC" >> Makefile
echo "CPP=$CPP" >> Makefile
echo "EXEC=$EXEC" >> Makefile
echo "OUTDIR=$OUTDIR" >> Makefile
cat Makefile.mk >> Makefile



exit 0
